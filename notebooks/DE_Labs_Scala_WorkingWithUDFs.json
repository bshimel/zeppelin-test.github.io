{"paragraphs":[{"text":"%md\n# About This Lab\n**Objective:** Be able to use User Defined Functions (UDFs) to transform DataFrames\n**File locations:** s3://shared-edu/sci/\n**Successful outcome:**\n**Before you begin:**\n**Related lessons:** Working with DataFrames\n\nCopyright © 2010–2021 Cloudera. All rights reserved.\nNot to be reproduced or shared without prior written consent from Cloudera.\n\n---","user":"freynalddeveuwest1","dateUpdated":"2022-01-25T14:17:29+0000","config":{"tableHide":true,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":false,"fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1643118316688_2076315402","id":"20171105-200834_1116095891","dateCreated":"2022-01-25T13:45:16+0000","dateStarted":"2022-01-25T14:17:48+0000","dateFinished":"2022-01-25T14:17:48+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:40935"},{"text":"%md\n## Overview\n\nIn this module we demonstrate how to create and apply user-defined functions.\n\n\n## User-Defined Functions\n\n* It is relatively easy to create and apply a user-defined function (UDF)\n    * Define a Scala function that operates on a row of data\n    * Register the Scala function as a UDF and specify the return type\n    * Apply the UDF as if it were a built-in function\n\n* Scala and any required packages must be installed on the worker nodes\n    * It is possible to distribute required packages via Spark\n\n* Built-in functions are more efficient than user-defined functions\n    * Use built-in functions when available\n    * Create user-defined functions only when necessary","user":"freynalddeveuwest1","dateUpdated":"2022-01-25T14:17:48+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1643118316689_-1707101087","id":"20210610-041300_636880277","dateCreated":"2022-01-25T13:45:16+0000","dateStarted":"2022-01-25T14:17:55+0000","dateFinished":"2022-01-25T14:17:55+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:40936"},{"text":"%md\n# Setup\n---","user":"freynalddeveuwest1","dateUpdated":"2022-01-25T14:17:55+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1643118316689_467392921","id":"20181114-164229_902436001","dateCreated":"2022-01-25T13:45:16+0000","dateStarted":"2022-01-25T14:17:56+0000","dateFinished":"2022-01-25T14:17:56+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:40937"},{"title":"Required for Kerberos operations","text":"%sh\n\necho $PASS | kinit $USER","user":"freynalddeveuwest1","dateUpdated":"2022-01-25T14:17:56+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/sh","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1643118444679_-746714544","id":"20220125-134724_582224061","dateCreated":"2022-01-25T13:47:24+0000","dateStarted":"2022-01-25T14:18:02+0000","dateFinished":"2022-01-25T14:18:02+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:40938"},{"title":"Setup the data context","text":"%sh\n\nrm -rf data\nmkdir -p data\naws s3 cp --recursive s3://shared-edu/sci/duocar/raw data/raw\nhdfs dfs -rm -r duocar\nhdfs dfs -mkdir -p duocar\nhdfs dfs -put -f data duocar","user":"freynalddeveuwest1","dateUpdated":"2022-01-25T14:18:03+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/sh","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1643118470623_-1206551962","id":"20220125-134750_479404743","dateCreated":"2022-01-25T13:47:50+0000","dateStarted":"2022-01-25T14:18:03+0000","dateFinished":"2022-01-25T14:18:15+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:40939"},{"title":"Read the raw ride data from HDF and clean it","text":"%spark\n\nval rides = spark.read.option(\"header\",\"true\").option(\"inferSchema\",\"true\").csv(\"duocar/data/raw/rides/\")\n\n// Cast `date_time` to a timestamp:\nimport org.apache.spark.sql.functions.{col}\n\nval rides_clean = rides.withColumn(\"date_time\", col(\"date_time\").cast(\"timestamp\"))","user":"freynalddeveuwest1","dateUpdated":"2022-01-25T14:18:15+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1643118316689_1115270983","id":"20210610-041458_574907270","dateCreated":"2022-01-25T13:45:16+0000","dateStarted":"2022-01-25T14:18:19+0000","dateFinished":"2022-01-25T14:18:20+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:40940"},{"text":"%md\n# Lesson\n---","user":"freynalddeveuwest1","dateUpdated":"2022-01-25T14:18:20+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1643118316689_-829112405","id":"20210609-150445_381117564","dateCreated":"2022-01-25T13:45:16+0000","dateStarted":"2022-01-25T14:18:27+0000","dateFinished":"2022-01-25T14:18:27+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:40941"},{"text":"%md\n## Example 1: Hour of Day","user":"freynalddeveuwest1","dateUpdated":"2022-01-25T14:18:28+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1643118316690_1000554967","id":"20210610-041602_390464956","dateCreated":"2022-01-25T13:45:16+0000","dateStarted":"2022-01-25T14:18:28+0000","dateFinished":"2022-01-25T14:18:28+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:40942"},{"title":"Define the Scala function","text":"%spark\n\nimport java.sql.Timestamp\ndef hour_of_day(time: Timestamp) : Int = return time.getHours ","user":"freynalddeveuwest1","dateUpdated":"2022-01-25T14:18:28+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1643118316690_211904707","id":"20210610-041616_689400131","dateCreated":"2022-01-25T13:45:16+0000","dateStarted":"2022-01-25T14:18:32+0000","dateFinished":"2022-01-25T14:18:34+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:40943"},{"title":"Note","text":"%md\nThe Spark `TimestampType` corresponds to Scala `java.sql.Timestamp` objects.","user":"freynalddeveuwest1","dateUpdated":"2022-01-25T14:18:34+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1643118316690_-2129389871","id":"20210610-041801_1207629809","dateCreated":"2022-01-25T13:45:16+0000","dateStarted":"2022-01-25T14:18:35+0000","dateFinished":"2022-01-25T14:18:35+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:40944"},{"title":"Test the Scala function","text":"%spark\n\nval dt = new Timestamp(2017, 7, 21, 5, 51, 10,0)\nhour_of_day(dt)","user":"freynalddeveuwest1","dateUpdated":"2022-01-25T14:18:35+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1643118316690_-1139383486","id":"20210610-041853_1273796548","dateCreated":"2022-01-25T13:45:16+0000","dateStarted":"2022-01-25T14:18:36+0000","dateFinished":"2022-01-25T14:18:37+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:40945"},{"title":"Register the Scala function as a UDF","text":"%spark\n\nimport org.apache.spark.sql.functions.{udf}\n\nval hour_of_day_udf = udf(hour_of_day(_: Timestamp))","user":"freynalddeveuwest1","dateUpdated":"2022-01-25T14:18:37+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1643118316690_1698146026","id":"20210610-041937_709330143","dateCreated":"2022-01-25T13:45:16+0000","dateStarted":"2022-01-25T14:18:38+0000","dateFinished":"2022-01-25T14:18:39+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:40946"},{"title":"Apply the UDF","text":"%spark\n\nrides_clean.select($\"date_time\", hour_of_day_udf($\"date_time\")).show(5, false)","user":"freynalddeveuwest1","dateUpdated":"2022-01-25T14:18:39+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1643118316690_275860041","id":"20210610-042028_341706402","dateCreated":"2022-01-25T13:45:16+0000","dateStarted":"2022-01-25T14:18:45+0000","dateFinished":"2022-01-25T14:18:46+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:40947"},{"title":"Use the UDF to compute the number of rides by hour of day","text":"%spark\n\n(rides_clean\n  .select(hour_of_day_udf($\"date_time\").alias(\"hour_of_day\"))\n  .groupBy(\"hour_of_day\")\n  .count()\n  .orderBy(\"hour_of_day\")\n  .show(25))","user":"freynalddeveuwest1","dateUpdated":"2022-01-25T14:18:46+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1643118316691_1557033090","id":"20210610-042204_1273871975","dateCreated":"2022-01-25T13:45:16+0000","dateStarted":"2022-01-25T14:18:50+0000","dateFinished":"2022-01-25T14:18:52+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:40948"},{"text":"%md\n## Example 2: Great-Circle Distance\n\nThe [great-circle distance](https://en.wikipedia.org/wiki/Great-circle_distance) is the shortest distance between two points on the surface of a sphere. \nIn this example we create a user-defined function to compute the [haversine approximation](https://en.wikipedia.org/wiki/Haversine_formula) to the great-circle distance between the ride origin and destination.","user":"freynalddeveuwest1","dateUpdated":"2022-01-25T14:18:52+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1643118316691_-783106102","id":"20210610-042619_599441245","dateCreated":"2022-01-25T13:45:16+0000","dateStarted":"2022-01-25T14:18:53+0000","dateFinished":"2022-01-25T14:18:53+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:40949"},{"title":"Define the haversine function","text":"%spark\n\ndef haversine(lat1: Double, lon1: Double, lat2: Double, lon2: Double): Int = {\n        val latDistance = Math.toRadians(lat2 - lat1)\n        val lngDistance = Math.toRadians(lon2 - lon1)\n        val sinLat = Math.sin(latDistance / 2)\n        val sinLng = Math.sin(lngDistance / 2)\n        val a = sinLat * sinLat +\n        (Math.cos(Math.toRadians(lat1)) *\n            Math.cos(Math.toRadians(lat2)) *\n            sinLng * sinLng)\n        val c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a))\n        (6371 * 1000 * c).toInt // Average radius of earth in km\n    }","user":"freynalddeveuwest1","dateUpdated":"2022-01-25T14:18:53+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1643118316691_-1345782612","id":"20210614-190254_449996867","dateCreated":"2022-01-25T13:45:16+0000","dateStarted":"2022-01-25T14:18:59+0000","dateFinished":"2022-01-25T14:19:00+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:40950"},{"title":"Test the Scala function","text":"%spark\n\nhaversine(36.12, -86.67, 33.94, -118.40)  // = 2887259.9506071107","user":"freynalddeveuwest1","dateUpdated":"2022-01-25T14:19:00+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1643118316691_-1337038712","id":"20210610-043006_1412529659","dateCreated":"2022-01-25T13:45:16+0000","dateStarted":"2022-01-25T14:19:08+0000","dateFinished":"2022-01-25T14:19:09+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:40951"},{"title":"Register the Scala function as a UDF","text":"%spark\n\nval haversine_udf = udf(haversine(_ : Double,_ : Double,_ : Double,_ : Double))","user":"freynalddeveuwest1","dateUpdated":"2022-01-25T14:19:10+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1643118316691_-597282694","id":"20210610-043318_1494705441","dateCreated":"2022-01-25T13:45:16+0000","dateStarted":"2022-01-25T14:19:10+0000","dateFinished":"2022-01-25T14:19:11+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:40952"},{"title":"Apply the haversine UDF","text":"%spark\n\nval distances = (rides\n  .withColumn(\"haversine_approximation\", haversine_udf($\"origin_lat\", $\"origin_lon\", $\"dest_lat\", $\"dest_lon\"))\n  .select(\"distance\", \"haversine_approximation\"))\ndistances.show(5)","user":"freynalddeveuwest1","dateUpdated":"2022-01-25T14:19:12+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1643118316692_531037713","id":"20210610-043404_145411034","dateCreated":"2022-01-25T13:45:16+0000","dateStarted":"2022-01-25T14:19:13+0000","dateFinished":"2022-01-25T14:19:14+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:40953"},{"title":"We expect the haversine approximation to be less than the ride distance","text":"%spark\n\n(distances\n  .select((col(\"haversine_approximation\") > col(\"distance\")).alias(\"haversine > distance\"))\n  .groupBy(\"haversine > distance\")\n  .count()\n  .show())\n\n// The null values correspond to cancelled rides:\nrides.filter(col(\"cancelled\") === 1).count()\n\n// The true values reflect the fact that the haversine formula is only an approximation to the great-circle distance:\ndistances.filter(col(\"haversine_approximation\") > col(\"distance\")).show(5)","user":"freynalddeveuwest1","dateUpdated":"2022-01-25T14:19:14+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1643118316692_63575980","id":"20210610-043506_1356303268","dateCreated":"2022-01-25T13:45:16+0000","dateStarted":"2022-01-25T14:19:21+0000","dateFinished":"2022-01-25T14:19:23+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:40954"},{"text":"%md\n# Lab\n---","user":"freynalddeveuwest1","dateUpdated":"2022-01-25T14:19:23+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1643118316692_-803016636","id":"20210609-150527_79851234","dateCreated":"2022-01-25T13:45:16+0000","dateStarted":"2022-01-25T14:19:29+0000","dateFinished":"2022-01-25T14:19:29+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:40955"},{"title":"1- Create a UDF that extracts the day of the week from a timestamp column","text":"%spark\n","user":"freynalddeveuwest1","dateUpdated":"2022-01-25T14:19:29+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1643118316692_-700988637","id":"20210610-044141_285955384","dateCreated":"2022-01-25T13:45:16+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:40956"},{"title":"Hint","text":"%md\nUse the [weekday](https://docs.python.org/2/library/datetime.html#datetime.datetime.weekday) method of the Python `datetime` class.","user":"freynalddeveuwest1","dateUpdated":"2022-01-25T14:19:33+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1643118316692_711815321","id":"20210610-044216_1671051028","dateCreated":"2022-01-25T13:45:16+0000","dateStarted":"2022-01-25T14:19:34+0000","dateFinished":"2022-01-25T14:19:34+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:40957"},{"title":"2 - Use the UDF to compute the number of rides by day of week","text":"%spark\n","user":"freynalddeveuwest1","dateUpdated":"2022-01-25T14:19:34+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1643118316693_1288804241","id":"20210610-044215_1321572347","dateCreated":"2022-01-25T13:45:16+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:40958"},{"title":"3 - Use the built-in function `dayofweek` to compute the number of rides by day of week","text":"%spark\n","user":"freynalddeveuwest1","dateUpdated":"2022-01-25T14:19:42+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1643118316693_-340409975","id":"20210610-044211_691709824","dateCreated":"2022-01-25T13:45:16+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:40959"},{"text":"%md\n# Result\n**You have now:** Learned how to use UDFs to transform DataFrames\n\n---","user":"freynalddeveuwest1","dateUpdated":"2022-01-25T14:19:49+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1643118316693_-398038250","id":"20181119-142716_792318228","dateCreated":"2022-01-25T13:45:16+0000","dateStarted":"2022-01-25T14:19:49+0000","dateFinished":"2022-01-25T14:19:49+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:40960"},{"text":"%md\n# Solution\n---","user":"freynalddeveuwest1","dateUpdated":"2022-01-25T14:19:49+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1643118316693_-626315184","id":"20171113-155535_1769142099","dateCreated":"2022-01-25T13:45:16+0000","dateStarted":"2022-01-25T14:19:55+0000","dateFinished":"2022-01-25T14:19:55+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:40961"},{"title":"1- Create a UDF that extracts the day of the week from a timestamp column","text":"%spark\n\n// Define the Scala function:\nimport java.sql.Timestamp\ndef day_of_week(time: Timestamp) : Int = return time.getDay\n\n// Register the Scala function as a UDF: \n\nimport org.apache.spark.sql.functions.{udf}\nval day_of_week_udf = udf(day_of_week(_: Timestamp))\n\n// Apply the UDF:\nrides_clean.select($\"date_time\", day_of_week_udf($\"date_time\")).show(5, false)","user":"freynalddeveuwest1","dateUpdated":"2022-01-25T14:19:55+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1643118316693_-199452368","id":"20210610-044512_1580013731","dateCreated":"2022-01-25T13:45:16+0000","dateStarted":"2022-01-25T14:19:56+0000","dateFinished":"2022-01-25T14:19:58+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:40962"},{"title":"2 - Use the UDF to compute the number of rides by day of week","text":"%spark\n\n(rides_clean\n  .withColumn(\"day_of_week\", day_of_week_udf($\"date_time\"))\n  .groupBy(\"day_of_week\")\n  .count()\n  .orderBy(\"day_of_week\")\n  .show())","user":"freynalddeveuwest1","dateUpdated":"2022-01-25T14:19:58+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1643118316693_1586275797","id":"20210610-044451_1176689375","dateCreated":"2022-01-25T13:45:16+0000","dateStarted":"2022-01-25T14:20:00+0000","dateFinished":"2022-01-25T14:20:02+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:40963"},{"title":"3 - Use the built-in function `dayofweek` to compute the number of rides by day of week","text":"%spark\n\nimport org.apache.spark.sql.functions.{dayofweek}\n\n(rides_clean\n  .withColumn(\"dayofweek\", dayofweek($\"date_time\"))\n  .groupBy(\"dayofweek\")\n  .count()\n  .orderBy(\"dayofweek\")\n  .show())","user":"freynalddeveuwest1","dateUpdated":"2022-01-25T14:20:02+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1643118316694_18091924","id":"20210610-044445_590752683","dateCreated":"2022-01-25T13:45:16+0000","dateStarted":"2022-01-25T14:20:06+0000","dateFinished":"2022-01-25T14:20:07+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:40964"},{"title":"Note","text":"%md\nDay 1 represents Sunday.","user":"freynalddeveuwest1","dateUpdated":"2022-01-25T14:20:07+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1643118316694_-671875655","id":"20210610-045022_306202457","dateCreated":"2022-01-25T13:45:16+0000","dateStarted":"2022-01-25T14:20:08+0000","dateFinished":"2022-01-25T14:20:08+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:40965"},{"text":"%md\n## References\n\n* [Python API - datetime module](https://docs.python.org/2/library/datetime.html)\n\n* [Spark Python API - pyspark.sql.functions.udf](http://spark.apache.org/docs/latest/api/python/reference/api/pyspark.sql.functions.udf.html)\n\n* [Spark Python API - pyspark.sql.functions.pandas_udf](http://spark.apache.org/docs/latest/api/python/reference/api/pyspark.sql.functions.pandas_udf.html#pyspark.sql.functions.pandas_udf)\n\n* [Cloudera Engineering Blog - Working with UDFs in Apache Spark](https://blog.cloudera.com/blog/2017/02/working-with-udfs-in-apache-spark/)\n\n* [Cloudera Engineering Blog - Use your favorite Python library on PySpark cluster with Cloudera Data Science Workbench](https://blog.cloudera.com/blog/2017/04/use-your-favorite-python-library-on-pyspark-cluster-with-cloudera-data-science-workbench/)\n","user":"freynalddeveuwest1","dateUpdated":"2022-01-25T14:20:08+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1643118316694_-2146999721","id":"20210610-043628_1324497606","dateCreated":"2022-01-25T13:45:16+0000","dateStarted":"2022-01-25T14:20:23+0000","dateFinished":"2022-01-25T14:20:23+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:40966"},{"title":"Additional resources","text":"%md\nWe hope you've enjoyed this lab. Below are additional resources that you should find useful:\n\n1. [Cloudera Tutorials](http://cloudera.com/tutorials.html) are your natural next step where you can explore Spark in more depth.\n2. [Cloudera Community](https://community.cloudera.com) is a great resource for questions and answers on Spark, Data Analytics/Science, and many more Big Data topics.\n3. [Apache Spark Documentation](https://spark.apache.org/documentation.html) - official Spark documentation.\n4. [Apache Zeppelin Project Home Page](https://zeppelin.apache.org) - official Zeppelin web site.","user":"freynalddeveuwest1","dateUpdated":"2022-01-25T14:20:23+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":10,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1643118316695_1535288910","id":"20181116-135131_93712280","dateCreated":"2022-01-25T13:45:16+0000","dateStarted":"2022-01-25T14:20:24+0000","dateFinished":"2022-01-25T14:20:24+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:40967"},{"text":"%angular\n</br>\n</br>\n</br>\n</br>\n<center>\n<a href=\"https://www.cloudera.com/about/training/courses.html\">\n  <img src=\"https://www.cloudera.com/content/dam/www/marketing/media-kit/logo-assets/cloudera_logo_darkorange.png\" alt=\"Cloudera University\" style=\"width:280px;height:40px;border:0;\" align=\"middle\">\n</a>\n</center>\n</br>\n</br>","user":"freynalddeveuwest1","dateUpdated":"2022-01-25T14:20:24+0000","config":{"tableHide":false,"editorSetting":{"language":"scala","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":2,"editorMode":"ace/mode/undefined","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1643118316695_1571680773","id":"20200110-154537_1406191376","dateCreated":"2022-01-25T13:45:16+0000","dateStarted":"2022-01-25T14:20:31+0000","dateFinished":"2022-01-25T14:20:31+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:40968"},{"text":"%angular\n","user":"freynalddeveuwest1","dateUpdated":"2022-01-25T14:20:31+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/undefined","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1643118316695_-2003100446","id":"20200110-162013_302547143","dateCreated":"2022-01-25T13:45:16+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:40969"}],"name":"DE/Labs/Scala/WorkingWithUDFs","id":"2GW7SJSKJ","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"angular:shared_process":[],"sh:shared_process":[],"livy:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}