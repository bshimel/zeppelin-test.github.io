{"paragraphs":[{"text":"%md\n# About This Lab\n**Objective:** Become familiar with Spark execution plans and the Spark UI\n**File locations:** s3://shared-edu/dev\n**Successful outcome:**\n**Before you begin:**\n**Related lessons:** Spark Distributed Processing\n\nCopyright © 2010–2021 Cloudera. All rights reserved.\nNot to be reproduced or shared without prior written consent from Cloudera.\n\n---","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:02:34+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648131532382_875169499","id":"20171105-200834_1116095891","dateCreated":"2022-03-24T14:18:52+0000","dateStarted":"2022-03-24T16:02:34+0000","dateFinished":"2022-03-24T16:02:34+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:27179"},{"text":"%md\n# Setup\n---","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T14:20:02+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648131532383_513395650","id":"20181114-164229_902436001","dateCreated":"2022-03-24T14:18:52+0000","dateStarted":"2022-03-24T14:20:02+0000","dateFinished":"2022-03-24T14:20:02+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27180"},{"title":"Required for Kerberos operations","text":"%sh\n\necho $PASS | kinit $USER","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:03:59+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/sh","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648132187724_-122285539","id":"20220324-142947_1882742959","dateCreated":"2022-03-24T14:29:47+0000","dateStarted":"2022-03-24T15:06:29+0000","dateFinished":"2022-03-24T15:06:29+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27181"},{"title":"Clean Database and HDFS Folders","text":"%jdbc(hive)\n\nDROP DATABASE IF EXISTS loudacre CASCADE;\nCREATE DATABASE loudacre;\nUSE loudacre;","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:05:54+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql","title":true,"tableHide":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648132230485_-53782191","id":"20220324-143030_830029200","dateCreated":"2022-03-24T14:30:30+0000","dateStarted":"2022-03-24T15:05:59+0000","dateFinished":"2022-03-24T15:06:12+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27182"},{"title":"Retrieve the data from S3","text":"%sh\n\naws s3 cp --recursive s3://shared-edu/dev/static_data/accounts data/loudacre/accounts\naws s3 cp --recursive s3://shared-edu/dev/accountdevice data/loudacre/accountdevice\nhdfs dfs -rm -r /tmp/raw\nhdfs dfs -mkdir -p /tmp/raw/accounts\nhdfs dfs -put -f data/loudacre/accounts/* /tmp/raw/accounts\nhdfs dfs -mkdir -p /tmp/raw/accountdevice\nhdfs dfs -put -f data/loudacre/accountdevice/* /tmp/raw/accountdevice\nhdfs dfs -chmod -R 777 /tmp/raw/\nhdfs dfs -mkdir -p /tmp/loudacre\nhdfs dfs -chmod 777 /tmp/loudacre","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:06:21+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/sh","title":true,"tableHide":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648132365911_1130481340","id":"20220324-143245_1093151894","dateCreated":"2022-03-24T14:32:45+0000","dateStarted":"2022-03-24T14:52:53+0000","dateFinished":"2022-03-24T14:53:14+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27183"},{"title":"Create the accounts table","text":"%sql\n\nCREATE EXTERNAL TABLE IF NOT EXISTS loudacre.accounts (\n    acct_num INT,\n    acct_create_dt TIMESTAMP,\n    acct_close_dt  TIMESTAMP,\n    first_name VARCHAR(255)  ,\n    last_name VARCHAR(255) ,\n    address  VARCHAR(255) ,\n    city  VARCHAR(255) ,\n    state VARCHAR(255) ,\n    zipcode VARCHAR(255) ,\n    phone_number VARCHAR(255) ,\n    created TIMESTAMP  ,\n    modified TIMESTAMP)\n    ROW FORMAT DELIMITED\n    FIELDS TERMINATED BY ','\n    STORED AS TEXTFILE\n    LOCATION '/tmp/loudacre/accounts'\n    TBLPROPERTIES ('external.table.purge'='true')","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:31:51+0000","config":{"tableHide":true,"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/sql","fontSize":9,"title":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{}},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648131532385_-1232020196","id":"20210611-072007_266262165","dateCreated":"2022-03-24T14:18:52+0000","dateStarted":"2022-03-24T15:06:23+0000","dateFinished":"2022-03-24T15:06:24+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27184"},{"title":"Load the data into the accounts table","text":"%sql\n\nLOAD DATA  INPATH '/tmp/raw/accounts' OVERWRITE INTO TABLE loudacre.accounts","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:08:37+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{}},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql","title":true,"tableHide":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648134452440_-1317667028","id":"20220324-150732_253394577","dateCreated":"2022-03-24T15:07:32+0000","dateStarted":"2022-03-24T15:08:59+0000","dateFinished":"2022-03-24T15:09:00+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27185"},{"title":"Required for explain in Spark 3.1","text":"%pyspark\n\nfrom py4j.java_gateway import java_import\njava_import(spark._sc._jvm, \"org.apache.spark.sql.api.python.*\")","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T14:22:20+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648131532385_-1126921370","id":"20210614-023533_397911748","dateCreated":"2022-03-24T14:18:52+0000","dateStarted":"2022-03-24T14:22:20+0000","dateFinished":"2022-03-24T14:22:21+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27186"},{"text":"%md\n# Lab\n---","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T15:09:19+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648131532386_-321464544","id":"20210609-150527_79851234","dateCreated":"2022-03-24T14:18:52+0000","dateStarted":"2022-03-24T15:09:19+0000","dateFinished":"2022-03-24T15:09:19+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27187"},{"title":"1 - Create a DataFrame of active accounts from the accounts table in the devsh database","text":"%pyspark\n","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T15:09:24+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648131532387_1910229911","id":"20210611-073024_145375792","dateCreated":"2022-03-24T14:18:52+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27188"},{"title":"2 - View the full execution plan for the new DataFrame","text":"%pyspark\n","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T15:09:28+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648131532387_-673773273","id":"20210611-073233_1543813054","dateCreated":"2022-03-24T14:18:52+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27189"},{"text":"%md\nCan you locate the line in the physical plan corresponding to the command to load the loudacre.accounts table into a DataFrame?\nHow many stages do you think this query has?","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T15:11:56+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648131532388_555334856","id":"20210611-073425_2082418815","dateCreated":"2022-03-24T14:18:52+0000","dateStarted":"2022-03-24T15:11:56+0000","dateFinished":"2022-03-24T15:11:56+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27190"},{"title":"3 - Call the DataFrame’s show function to execute the query","text":"%pyspark\n","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T15:12:03+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648131532388_-1444761016","id":"20210611-073424_615834019","dateCreated":"2022-03-24T14:18:52+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27191"},{"title":"4 - View the Spark Application UI and choose the SQL tab","text":"%md\nThis displays a list of DataFrame and Dataset queries you have executed, with the most recent query at the top.","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T15:14:28+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648131532389_-30177694","id":"20210611-073738_1667755047","dateCreated":"2022-03-24T14:18:52+0000","dateStarted":"2022-03-24T15:14:28+0000","dateFinished":"2022-03-24T15:14:28+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27192"},{"title":"5 - Click the description for the top query to see the visualization of the query’s execution","text":"%md\nYou can also see the query’s full execution plan by opening the Details panel below the visualization graph.","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T15:14:39+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648131532389_-2069550577","id":"20210611-073831_977786980","dateCreated":"2022-03-24T14:18:52+0000","dateStarted":"2022-03-24T15:14:39+0000","dateFinished":"2022-03-24T15:14:39+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27193"},{"title":"6 - View the execution plan","text":"%md\nThe first step in the execution is a HiveTableScan, which loaded the account data into the DataFrame. Hover your mouse over the step to show the step’s execution plan. Compare that to the physical plan for the query. Note that it is the same as the last line in the physical execution plan, because it is the first step to execute. Did you correctly identify this line in the execution plan as the one corresponding to the DataFrame.read.table operation?","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T15:14:53+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648131532390_2146827150","id":"20210611-073942_906093501","dateCreated":"2022-03-24T14:18:52+0000","dateStarted":"2022-03-24T15:14:53+0000","dateFinished":"2022-03-24T15:14:53+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27194"},{"title":"7 - Click the SQL tab to return to the main SQL query summary tab","text":"%md\nThe Job IDs column provides links to the jobs that executed as part of this query execution. In this case, the query consisted of just a single job. Click the job’s ID to view the job details. This will display a list of stages that were completed for the query.\nHow many stages executed? \nIs that the number of stages you predicted it would be?","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T15:15:54+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648131532390_848403267","id":"20210611-074202_1994203597","dateCreated":"2022-03-24T14:18:52+0000","dateStarted":"2022-03-24T15:15:54+0000","dateFinished":"2022-03-24T15:15:54+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27195"},{"title":"8 - Click the description of the stage to view metrics on the execution of the stage and its tasks","text":"%md\nClick the description of the stage to view metrics on the execution of the stage and its tasks.","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T15:16:09+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648131532391_2088583644","id":"20210611-074315_1603171282","dateCreated":"2022-03-24T14:18:52+0000","dateStarted":"2022-03-24T15:16:09+0000","dateFinished":"2022-03-24T15:16:09+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27196"},{"text":"%md\nThe previous query was very simple, involving just a single data source with a where to return only active accounts. Try executing a more complex query that joins data from two different data sources.\nThis query reads in the accountdevice data file, which maps account IDs to associated device IDs. Then it joins that data with the DataFrame of active accounts you created above. The result is DataFrame consisting of all device IDs in use by currently active accounts.\n\n```python\naccountDeviceDF = spark.read.option(\"header\",\"true\").option(\"inferSchema\",\"true\").csv(\"/tmp/raw/accountdevice\")\nactiveAcctDevsDF = activeAccountsDF.join(accountDeviceDF,activeAccountsDF.acct_num == accountDeviceDF.account_id).select(\"device_id\")\n```","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:14:06+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648131532391_1570072412","id":"20210611-074400_688595035","dateCreated":"2022-03-24T14:18:52+0000","dateStarted":"2022-03-24T16:14:06+0000","dateFinished":"2022-03-24T16:14:06+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27197"},{"title":"9 - Execute a more complex query","text":"%pyspark\n","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T15:19:27+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648131532392_1191691279","id":"20210611-075402_1616682843","dateCreated":"2022-03-24T14:18:52+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27198"},{"text":"%md\nReview the full execution plan using explain, as you did with the previous DataFrame.\nCan you identify which lines in the execution plan load the two different data sources?\nHow many stages do you think this query will execute?","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T15:29:57+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"results":{},"enabled":true,"editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648131532392_-520227511","id":"20210611-080853_2012866519","dateCreated":"2022-03-24T14:18:52+0000","dateStarted":"2022-03-24T15:29:57+0000","dateFinished":"2022-03-24T15:29:57+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27199"},{"title":"10 - Review the full execution plan using explain","text":"%pyspark\n","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T15:30:46+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648131532393_-435903574","id":"20210611-080825_1664775114","dateCreated":"2022-03-24T14:18:52+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27200"},{"title":"11 - Execute the query and review the execution visualization in the Spark UI","text":"%pyspark\n","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T15:31:59+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648131532393_-978589169","id":"20210611-081035_1148361594","dateCreated":"2022-03-24T14:18:52+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27201"},{"text":"%md\nWhat differences do you see between the execution of the earlier query and this one?\nHow many stages executed? Is this what you expected?","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T15:32:10+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648131532394_655032640","id":"20210611-081141_1220744580","dateCreated":"2022-03-24T14:18:52+0000","dateStarted":"2022-03-24T15:32:10+0000","dateFinished":"2022-03-24T15:32:10+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27202"},{"title":"Optional","text":"%md\nExplore an even more complex queries that involves multiple joins with three data sources.","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T15:32:16+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648131532395_-1712470995","id":"20210611-081216_979089903","dateCreated":"2022-03-24T14:18:52+0000","dateStarted":"2022-03-24T15:32:16+0000","dateFinished":"2022-03-24T15:32:16+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27203"},{"text":"%md\n# Result\n**You have now:** become familiar with Spark execution plans and the Spark UI.\n\n---","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T15:32:27+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648131532395_368717047","id":"20181119-142716_792318228","dateCreated":"2022-03-24T14:18:52+0000","dateStarted":"2022-03-24T15:32:27+0000","dateFinished":"2022-03-24T15:32:27+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27204"},{"text":"%md\n# Solution\n---","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T15:32:31+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648131532396_704314889","id":"20171113-155535_1769142099","dateCreated":"2022-03-24T14:18:52+0000","dateStarted":"2022-03-24T15:32:31+0000","dateFinished":"2022-03-24T15:32:31+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27205"},{"title":"1 - Create a DataFrame of active accounts from the accounts table in the devsh database","text":"%pyspark\n\naccountsDF = spark.read.table(\"loudacre.accounts\")\nactiveAccountsDF = accountsDF.select(\"acct_num\").where(accountsDF.acct_close_dt.isNull())","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T15:32:58+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648131532397_-74890401","id":"20210611-064555_803158319","dateCreated":"2022-03-24T14:18:52+0000","dateStarted":"2022-03-24T15:32:59+0000","dateFinished":"2022-03-24T15:33:00+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27206"},{"title":"2 - View the full execution plan for the new DataFrame","text":"%pyspark\n\nactiveAccountsDF.explain(True)","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T15:33:06+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648131532398_-1370416515","id":"20210611-073254_682044044","dateCreated":"2022-03-24T14:18:52+0000","dateStarted":"2022-03-24T15:33:08+0000","dateFinished":"2022-03-24T15:33:09+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27207"},{"title":"3 - Call the DataFrame’s show function to execute the query","text":"%pyspark\n\nactiveAccountsDF.show()","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T15:33:22+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648131532398_1645750300","id":"20210611-073649_1986510652","dateCreated":"2022-03-24T14:18:52+0000","dateStarted":"2022-03-24T15:33:22+0000","dateFinished":"2022-03-24T15:33:23+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27208"},{"title":"9 - Execute a more complex query","text":"%pyspark\n\naccountDeviceDF = spark.read.option(\"header\",\"true\").option(\"inferSchema\",\"true\").csv(\"/tmp/raw/accountdevice\")\nactiveAcctDevsDF = activeAccountsDF.join(accountDeviceDF,activeAccountsDF.acct_num == accountDeviceDF.account_id).select(\"device_id\")","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T15:34:40+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648131532399_1810334920","id":"20210611-075505_191478305","dateCreated":"2022-03-24T14:18:52+0000","dateStarted":"2022-03-24T15:34:41+0000","dateFinished":"2022-03-24T15:34:44+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27209"},{"title":"10 - Review the full execution plan using explain","text":"%pyspark\n\nactiveAcctDevsDF.explain(True)","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T15:35:07+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648131532400_-1674828639","id":"20210611-080931_698236503","dateCreated":"2022-03-24T14:18:52+0000","dateStarted":"2022-03-24T15:35:07+0000","dateFinished":"2022-03-24T15:35:08+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27210"},{"title":"11 - Execute the query and review the execution visualization in the Spark UI","text":"%pyspark\n\nactiveAcctDevsDF.show()","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T15:35:16+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648131532400_-1679439194","id":"20210611-081105_797939","dateCreated":"2022-03-24T14:18:52+0000","dateStarted":"2022-03-24T15:35:16+0000","dateFinished":"2022-03-24T15:35:17+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27211"},{"title":"Additional resources","text":"%md\nWe hope you've enjoyed this lab. Below are additional resources that you should find useful:\n\n1. [Cloudera Tutorials](http://cloudera.com/tutorials.html) are your natural next step where you can explore Spark in more depth.\n2. [Cloudera Community](https://community.cloudera.com) is a great resource for questions and answers on Spark, Data Analytics/Science, and many more Big Data topics.\n3. [Apache Spark Documentation](https://spark.apache.org/documentation.html) - official Spark documentation.\n4. [Apache Zeppelin Project Home Page](https://zeppelin.apache.org) - official Zeppelin web site.","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T15:39:01+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":10,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648131532403_-648789847","id":"20181116-135131_93712280","dateCreated":"2022-03-24T14:18:52+0000","dateStarted":"2022-03-24T15:39:01+0000","dateFinished":"2022-03-24T15:39:01+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27212"},{"text":"%angular\n</br>\n</br>\n</br>\n</br>\n<center>\n<a href=\"https://www.cloudera.com/about/training/courses.html\">\n  <img src=\"https://www.cloudera.com/content/dam/www/marketing/media-kit/logo-assets/cloudera_logo_darkorange.png\" alt=\"Cloudera University\" style=\"width:280px;height:40px;border:0;\" align=\"middle\">\n</a>\n</center>\n</br>\n</br>","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T15:39:07+0000","config":{"tableHide":false,"editorSetting":{"language":"scala","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":2,"editorMode":"ace/mode/undefined","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648131532404_-469962720","id":"20200110-154537_1406191376","dateCreated":"2022-03-24T14:18:52+0000","dateStarted":"2022-03-24T15:39:07+0000","dateFinished":"2022-03-24T15:39:07+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27213"},{"text":"%angular\n","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T14:18:52+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/undefined","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648131532405_-1896590187","id":"20200110-162013_302547143","dateCreated":"2022-03-24T14:18:52+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:27214"}],"name":"DE/Labs/Pyspark/ExploreQueryExecution","id":"2GY4PBJ7H","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"angular:shared_process":[],"sh:shared_process":[],"jdbc:shared_process":[],"livy:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}