{"paragraphs":[{"text":"%md\n# About This Lab\n**Objective:** Become familiar with Spark persistence operations\n**File locations:** s3://shared-edu/dev\n**Successful outcome:**\n**Before you begin:**\n**Related lessons:** Spark Distributed Persistence\n\nCopyright © 2010–2021 Cloudera. All rights reserved.\nNot to be reproduced or shared without prior written consent from Cloudera.\n\n---","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:26:56+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208668_1626748613","id":"20171105-200834_1116095891","dateCreated":"2022-03-24T16:26:48+0000","dateStarted":"2022-03-24T16:26:56+0000","dateFinished":"2022-03-24T16:26:56+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:34225"},{"text":"%md\n# Setup\n---","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:27:13+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208669_-2042530456","id":"20181114-164229_902436001","dateCreated":"2022-03-24T16:26:48+0000","dateStarted":"2022-03-24T16:27:13+0000","dateFinished":"2022-03-24T16:27:13+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34226"},{"title":"Required for Kerberos operations","text":"%sh\n\necho $PASS | kinit $USER","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:27:17+0000","config":{"tableHide":true,"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/sh","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208669_-260357635","id":"20220324-160343_1531140688","dateCreated":"2022-03-24T16:26:48+0000","dateStarted":"2022-03-24T16:27:30+0000","dateFinished":"2022-03-24T16:27:30+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34227"},{"title":"Clean Database and HDFS Folders","text":"%jdbc(hive)\n\nDROP DATABASE IF EXISTS loudacre CASCADE;\nCREATE DATABASE loudacre;\nUSE loudacre;","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:33:24+0000","config":{"tableHide":true,"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/sql","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208669_1766981389","id":"20220324-160539_1592865158","dateCreated":"2022-03-24T16:26:48+0000","dateStarted":"2022-03-24T16:33:24+0000","dateFinished":"2022-03-24T16:33:38+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34228"},{"title":"Retrieve the data from S3","text":"%sh\n\naws s3 cp --recursive s3://shared-edu/dev/static_data/accounts data/loudacre/accounts\naws s3 cp --recursive s3://shared-edu/dev/accountdevice data/loudacre/accountdevice\nhdfs dfs -rm -r /tmp/raw\nhdfs dfs -mkdir -p /tmp/raw/accounts\nhdfs dfs -put -f data/loudacre/accounts/* /tmp/raw/accounts\nhdfs dfs -mkdir -p /tmp/raw/accountdevice\nhdfs dfs -put -f data/loudacre/accountdevice/* /tmp/raw/accountdevice\nhdfs dfs -chmod -R 777 /tmp/raw/\nhdfs dfs -mkdir -p /tmp/loudacre\nhdfs dfs -chmod 777 /tmp/loudacre","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:34:24+0000","config":{"tableHide":true,"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/sh","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208670_1895673297","id":"20210611-110230_1929902609","dateCreated":"2022-03-24T16:26:48+0000","dateStarted":"2022-03-24T16:34:24+0000","dateFinished":"2022-03-24T16:34:42+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34229"},{"title":"Create the accounts table","text":"%sql\n\nCREATE EXTERNAL TABLE IF NOT EXISTS loudacre.accounts (\n    acct_num INT,\n    acct_create_dt TIMESTAMP,\n    acct_close_dt  TIMESTAMP,\n    first_name VARCHAR(255)  ,\n    last_name VARCHAR(255) ,\n    address  VARCHAR(255) ,\n    city  VARCHAR(255) ,\n    state VARCHAR(255) ,\n    zipcode VARCHAR(255) ,\n    phone_number VARCHAR(255) ,\n    created TIMESTAMP  ,\n    modified TIMESTAMP)\n    ROW FORMAT DELIMITED\n    FIELDS TERMINATED BY ','\n    STORED AS TEXTFILE\n    LOCATION '/tmp/loudacre/accounts'\n    TBLPROPERTIES ('external.table.purge'='true')","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:33:42+0000","config":{"tableHide":true,"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/sql","fontSize":9,"title":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{}},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}},"1":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{}},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208670_-796219921","id":"20210611-110303_241216108","dateCreated":"2022-03-24T16:26:48+0000","dateStarted":"2022-03-24T16:33:44+0000","dateFinished":"2022-03-24T16:33:45+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34230"},{"title":"Load the data into the accounts table","text":"%sql\n\nLOAD DATA  INPATH '/tmp/raw/accounts' OVERWRITE INTO TABLE loudacre.accounts","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:35:17+0000","config":{"tableHide":true,"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/sql","fontSize":9,"title":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{}},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208670_-1080432788","id":"20220324-160822_168252418","dateCreated":"2022-03-24T16:26:48+0000","dateStarted":"2022-03-24T16:35:18+0000","dateFinished":"2022-03-24T16:35:19+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34231"},{"text":"%md\n# Lab\n---","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:35:28+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208670_203727934","id":"20210609-150527_79851234","dateCreated":"2022-03-24T16:26:48+0000","dateStarted":"2022-03-24T16:35:28+0000","dateFinished":"2022-03-24T16:35:28+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34232"},{"text":"%md\nCreate a DataFrame that joins account data for all accounts with their associated devices using the followin code:\n```scala\nval accountsDF = spark.read.table(\"loudacre.accounts\")\nval accountDeviceDF = spark.read.option(\"header\",\"true\").option(\"inferSchema\",\"true\").csv(\"/tmp/raw/accountdevice\")\nval accountsDevsDF =  accountsDF.join(accountDeviceDF,$\"acct_num\" === $\"account_id\")\n```","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:41:00+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208670_1787989659","id":"20210611-105809_199359032","dateCreated":"2022-03-24T16:26:48+0000","dateStarted":"2022-03-24T16:41:00+0000","dateFinished":"2022-03-24T16:41:00+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34233"},{"title":"1 - Create a DataFrame that joins account data for all accounts with their associated devices","text":"%spark\n\n","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:41:14+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208671_1031517824","id":"20210611-105835_866889491","dateCreated":"2022-03-24T16:26:48+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34234"},{"text":"%md\nThe query code you pasted above defines a new DataFrame called accountsDevsDF, which joins account data and device data. \nTry executing a query starting with the accountsDevsDF DataFrame that displays the account number, first name, last name and device ID for each row.","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:41:21+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208671_-1530686497","id":"20210611-110535_1728028059","dateCreated":"2022-03-24T16:26:48+0000","dateStarted":"2022-03-24T16:41:28+0000","dateFinished":"2022-03-24T16:41:28+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34235"},{"title":"2 - Displays the account number, first name, last name and device ID for each row","text":"%spark\n\n","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:41:28+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208671_-820356224","id":"20210611-110605_1716103283","dateCreated":"2022-03-24T16:26:48+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34236"},{"title":"3 - View the execution visualization of the query you just executed","text":"%md\nIn your browser, go to the SQL tab of your application’s Spark UI, and view the execution visualization of the query you just executed. Take note of the complexity so that you can compare it to later executions when using persistence.\nRemember that queries are listed in the SQL tab in the order they were executed, starting with the most recent. The descriptions of multiple executions of the same action will not distinguish one query from another, so make sure you choose the correct one for the query you are looking at.","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:41:29+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208671_1116681230","id":"20210611-110850_409810982","dateCreated":"2022-03-24T16:26:48+0000","dateStarted":"2022-03-24T16:41:34+0000","dateFinished":"2022-03-24T16:41:34+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34237"},{"title":"4 - Persist the accountsDevsDF DataFrame using the default storage level","text":"%spark\n","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:41:34+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208671_-324697033","id":"20210611-111026_1781089264","dateCreated":"2022-03-24T16:26:48+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34238"},{"title":"5 - Repeat the final steps of the query you executed above","text":"%spark\n","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:41:36+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208672_128880688","id":"20210611-111206_1749911035","dateCreated":"2022-03-24T16:26:48+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34239"},{"title":"6 - View the execution visualization of the query you just re-executed","text":"%md\nIn the browser, reload the Spark UI SQL tab, and view the execution diagram for the query just executed. Notice that it has far fewer steps. Instead of reading, filtering, and joining the data from the two sources, it reads the persisted data from memory. If you hover your mouse over the memory scan step, you will see that the only operation it performs on the data in memory is the last step of the query: the unpersisted select transformation. Compare the diagram for this query with the first one you executed above, before persisting.","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:41:36+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208672_139755723","id":"20210611-111257_1362680084","dateCreated":"2022-03-24T16:26:48+0000","dateStarted":"2022-03-24T16:41:57+0000","dateFinished":"2022-03-24T16:41:57+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34240"},{"text":"%md\nThe first time you execute a query on a persisted DataFrame, Dataset, or RDD, Spark has to execute the full query in order to materialize the data that gets saved in memory or on disk. Compare the difference between the first and second queries after executing persist by re-executing the query one final time.\n","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:41:57+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208672_-1697592610","id":"20210611-112433_497244132","dateCreated":"2022-03-24T16:26:48+0000","dateStarted":"2022-03-24T16:41:58+0000","dateFinished":"2022-03-24T16:41:58+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34241"},{"title":"7 - Re-execute the query one final time","text":"%spark\n\n","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:41:58+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208672_262997921","id":"20210611-112508_196375956","dateCreated":"2022-03-24T16:26:48+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34242"},{"text":"%md\nThen use the Spark UI to compare both queries executed after the persist operation, and consider these questions.\n* Do the execution diagrams differ? Why or why not?\n* Did one query take longer than the other? If so, which one, and why?","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:41:59+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208672_-1013374852","id":"20210611-112505_93520049","dateCreated":"2022-03-24T16:26:48+0000","dateStarted":"2022-03-24T16:42:00+0000","dateFinished":"2022-03-24T16:42:00+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34243"},{"title":"8 - View the Storage tab in the Spark UI","text":"%md\nView the Storage tab in the Spark UI to see currently persisted data. \nThe list shows the RDD identified by the execution plan for the query that generated the data. Consider these questions.\n* What is the storage level of the RDD?\n* How many partitions of the RDD were persisted and how much space do those partitions take up in memory and on disk?\n* Note that only a small percentage of the data is cached. Why is that? How could you cache more of the data?\n* Click the RDD name to view the storage details. Which executors are storing data for this RDD?","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:42:00+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208672_-1220603052","id":"20210611-112813_2061354692","dateCreated":"2022-03-24T16:26:48+0000","dateStarted":"2022-03-24T16:42:06+0000","dateFinished":"2022-03-24T16:42:06+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34244"},{"title":"9 - Execute the same query as above using the write action instead of show","text":"%spark\n","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:42:06+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208673_-287402473","id":"20210611-113046_1880786693","dateCreated":"2022-03-24T16:26:48+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34245"},{"title":"10 - Reload the Spark UI Storage tab","text":"%md\n* What percentage of the data is cached? Why? How does this compare to the last time you persisted the data?\n* How much memory is the data taking up? How much disk space?","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:42:07+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208673_-2027933831","id":"20210611-113309_448348382","dateCreated":"2022-03-24T16:26:48+0000","dateStarted":"2022-03-24T16:42:07+0000","dateFinished":"2022-03-24T16:42:07+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34246"},{"title":"11 - Unpersist the accountsDevsDF DataFrame","text":"%spark\n","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:42:08+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208673_2004481248","id":"20210611-113456_2003230115","dateCreated":"2022-03-24T16:26:48+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34247"},{"title":"12 - View the Spark UI Storage to verify that the cache for accountsDevsDF has been removed","text":"%md\nView the Spark UI Storage to verify that the cache for accountsDevsDF has been removed.","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:42:57+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208673_-582140188","id":"20210611-113601_714370551","dateCreated":"2022-03-24T16:26:48+0000","dateStarted":"2022-03-24T16:42:57+0000","dateFinished":"2022-03-24T16:42:57+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34248"},{"title":"13 - Repersist the same DataFrame, setting the storage level to save the data to files on disk, replicated twice","text":"%spark\n","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:42:58+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208673_-1878236600","id":"20210611-113654_841409712","dateCreated":"2022-03-24T16:26:48+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34249"},{"title":"14 - Reexecute the previous query","text":"%spark\n","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:43:08+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208674_-218278118","id":"20210611-113822_870111413","dateCreated":"2022-03-24T16:26:48+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34250"},{"title":"15 - Reload the Storage tab to confirm that the storage level for the RDD is set correctly","text":"%md\nAlso consider these questions:\n* How much memory is the data taking up? How much disk space?\n* Which executors are storing the RDD’s data files?\n* How many partitions are stored? Are they replicated? Where?","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:43:09+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208674_-876864822","id":"20210611-113929_1658470252","dateCreated":"2022-03-24T16:26:48+0000","dateStarted":"2022-03-24T16:43:16+0000","dateFinished":"2022-03-24T16:43:16+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34251"},{"text":"%md\n# Result\n**You have now:** become familiar with Spark persistence operations.\n\n---","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:43:16+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208674_-1183310969","id":"20181119-142716_792318228","dateCreated":"2022-03-24T16:26:48+0000","dateStarted":"2022-03-24T16:43:38+0000","dateFinished":"2022-03-24T16:43:38+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34252"},{"text":"%md\n# Solution\n---","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:43:38+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208674_1166352332","id":"20171113-155535_1769142099","dateCreated":"2022-03-24T16:26:48+0000","dateStarted":"2022-03-24T16:43:39+0000","dateFinished":"2022-03-24T16:43:39+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34253"},{"title":"1 - Create a DataFrame that joins account data for all accounts with their associated devices","text":"%spark\n\nval accountsDF = spark.read.table(\"loudacre.accounts\")\nval accountDeviceDF = spark.read.option(\"header\",\"true\").option(\"inferSchema\",\"true\").csv(\"/tmp/raw/accountdevice\")\nval accountsDevsDF =  accountsDF.join(accountDeviceDF,$\"acct_num\" === $\"account_id\")","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:43:39+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true,"tableHide":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208674_2049251839","id":"20210611-110435_672570659","dateCreated":"2022-03-24T16:26:48+0000","dateStarted":"2022-03-24T16:43:51+0000","dateFinished":"2022-03-24T16:43:52+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34254"},{"title":"2 - Display the account number, first name, last name and device ID for each row","text":"%spark\n\naccountsDevsDF.select(\"acct_num\",\"first_name\",\"last_name\",\"device_id\").show(5)","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:43:52+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208675_1376395936","id":"20210611-110728_991524267","dateCreated":"2022-03-24T16:26:48+0000","dateStarted":"2022-03-24T16:43:58+0000","dateFinished":"2022-03-24T16:43:59+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34255"},{"title":"4 - Persist the accountsDevsDF DataFrame using the default storage level","text":"%spark\n\naccountsDevsDF.persist()","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:44:00+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208675_2087283462","id":"20210611-111128_793933915","dateCreated":"2022-03-24T16:26:48+0000","dateStarted":"2022-03-24T16:44:00+0000","dateFinished":"2022-03-24T16:44:01+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34256"},{"title":"5 - Repeat the final steps of the query you executed above","text":"%spark\n\naccountsDevsDF.select(\"acct_num\",\"first_name\",\"last_name\",\"device_id\").show(5)","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:44:01+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208675_1570551357","id":"20210611-111226_2002323970","dateCreated":"2022-03-24T16:26:48+0000","dateStarted":"2022-03-24T16:44:05+0000","dateFinished":"2022-03-24T16:44:07+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34257"},{"title":"6 - Display the account number, first name, last name and device ID for each row again","text":"%spark\n\naccountsDevsDF.select(\"acct_num\",\"first_name\",\"last_name\",\"device_id\").show(5)","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:44:07+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208675_1749095684","id":"20210611-111722_854707605","dateCreated":"2022-03-24T16:26:48+0000","dateStarted":"2022-03-24T16:44:21+0000","dateFinished":"2022-03-24T16:44:22+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34258"},{"title":"7 - Re-execute the query one final time","text":"%spark\n\naccountsDevsDF.select(\"acct_num\",\"first_name\",\"last_name\",\"device_id\").show(5)","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:44:22+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208675_-1615245220","id":"20210611-112733_640065956","dateCreated":"2022-03-24T16:26:48+0000","dateStarted":"2022-03-24T16:44:26+0000","dateFinished":"2022-03-24T16:44:27+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34259"},{"title":"9 - Execute the same query as above using the write action instead of show","text":"%spark\n\naccountsDevsDF.write.mode(\"overwrite\").save(\"loudacre/accounts_devices\")","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:44:27+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208676_-1025661646","id":"20210611-113151_174602916","dateCreated":"2022-03-24T16:26:48+0000","dateStarted":"2022-03-24T16:44:28+0000","dateFinished":"2022-03-24T16:44:34+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34260"},{"title":"11 - Unpersist the accountsDevsDF DataFrame","text":"%spark\n\naccountsDevsDF.unpersist()","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:44:34+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208676_-6590660","id":"20210611-113526_226614022","dateCreated":"2022-03-24T16:26:48+0000","dateStarted":"2022-03-24T16:44:41+0000","dateFinished":"2022-03-24T16:44:42+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34261"},{"title":"13 - Repersist the same DataFrame, setting the storage level to save the data to files on disk, replicated twice","text":"%spark\n\nimport org.apache.spark.storage.StorageLevel\naccountsDevsDF.persist(StorageLevel.DISK_ONLY_2)","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:45:12+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208676_999264188","id":"20210611-113716_893225978","dateCreated":"2022-03-24T16:26:48+0000","dateStarted":"2022-03-24T16:45:25+0000","dateFinished":"2022-03-24T16:45:26+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34262"},{"title":"14 - Reexecute the previous query","text":"%spark\n\naccountsDevsDF.write.mode(\"overwrite\").save(\"loudacre/accounts_devices\")","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:45:39+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208676_1280076396","id":"20210611-110101_323105112","dateCreated":"2022-03-24T16:26:48+0000","dateStarted":"2022-03-24T16:45:39+0000","dateFinished":"2022-03-24T16:45:47+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34263"},{"title":"Additional resources","text":"%md\nWe hope you've enjoyed this lab. Below are additional resources that you should find useful:\n\n1. [Cloudera Tutorials](http://cloudera.com/tutorials.html) are your natural next step where you can explore Spark in more depth.\n2. [Cloudera Community](https://community.cloudera.com) is a great resource for questions and answers on Spark, Data Analytics/Science, and many more Big Data topics.\n3. [Apache Spark Documentation](https://spark.apache.org/documentation.html) - official Spark documentation.\n4. [Apache Zeppelin Project Home Page](https://zeppelin.apache.org) - official Zeppelin web site.","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:45:51+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":10,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208676_447380973","id":"20181116-135131_93712280","dateCreated":"2022-03-24T16:26:48+0000","dateStarted":"2022-03-24T16:45:51+0000","dateFinished":"2022-03-24T16:45:51+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34264"},{"text":"%angular\n</br>\n</br>\n</br>\n</br>\n<center>\n<a href=\"https://www.cloudera.com/about/training/courses.html\">\n  <img src=\"https://www.cloudera.com/content/dam/www/marketing/media-kit/logo-assets/cloudera_logo_darkorange.png\" alt=\"Cloudera University\" style=\"width:280px;height:40px;border:0;\" align=\"middle\">\n</a>\n</center>\n</br>\n</br>","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:45:56+0000","config":{"tableHide":false,"editorSetting":{"language":"scala","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":2,"editorMode":"ace/mode/undefined","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208676_-1258971713","id":"20200110-154537_1406191376","dateCreated":"2022-03-24T16:26:48+0000","dateStarted":"2022-03-24T16:45:56+0000","dateFinished":"2022-03-24T16:45:56+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34265"},{"text":"%angular\n","user":"freynalddeveuwest1","dateUpdated":"2022-03-24T16:26:48+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/undefined"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1648139208677_-1709900528","id":"20220324-162605_1195069068","dateCreated":"2022-03-24T16:26:48+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:34266"}],"name":"DE/Labs/Scala/PersistingDataFrames","id":"2GYVUNYYF","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"angular:shared_process":[],"sh:shared_process":[],"jdbc:shared_process":[],"livy:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}